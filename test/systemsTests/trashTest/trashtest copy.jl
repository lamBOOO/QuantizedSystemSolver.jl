using Symbolics, LinearAlgebra

@show 2
@variables x,il1,il2,il3,rd1,rd2,rd3,rr,rpr,v,is1,is2,is3,I
#A=[5.1e-6+4.2e-9+0.453e-6*x 4.2e-9+0.453e-6*x  4.2e-9+0.453e-6*x  ;4.2e-9+0.453e-6*x  5.1e-6+4.2e-9+0.453e-6*x  4.2e-9+0.453e-6*x ;4.2e-9+0.453e-6*x  4.2e-9+0.453e-6*x  5.1e-6+4.2e-9+0.453e-6*x ]
A=[5.1+4.2e-3+0.453*x 4.2e-3+0.453*x  4.2e-3+0.453*x  ;4.2e-3+0.453*x  5.1+4.2e-3+0.453*x  4.2e-3+0.453*x ;4.2e-3+0.453*x  4.2e-3+0.453*x  5.1+4.2e-3+0.453*x ]
B=(inv(A))
#display(B)

#= B = [(-((4.2e-9 + 4.53e-7x)^2) + (5.1042e-6 + 4.53e-7x)^2) / ((4.2e-9 + 4.53e-7x)*((4.2e-9 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x)) + (5.1042e-6 + 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (5.1042e-6 + 4.53e-7x)^2) + (-5.1042e-6 - 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x))) ((4.2e-9 + 4.53e-7x)^2 - ((5.1042e-6 + 4.53e-7x)^2)) / ((4.2e-9 + 4.53e-7x)*((4.2e-9 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x)) + (5.1042e-6 + 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (5.1042e-6 + 4.53e-7x)^2) + (-5.1042e-6 - 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x))) 0; ((4.2e-9 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x)) / ((4.2e-9 + 4.53e-7x)*((4.2e-9 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x)) + (5.1042e-6 + 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (5.1042e-6 + 4.53e-7x)^2) + (-5.1042e-6 - 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x))) (-((4.2e-9 + 4.53e-7x)^2) + (5.1042e-6 + 4.53e-7x)^2) / ((4.2e-9 + 4.53e-7x)*((4.2e-9 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x)) + (5.1042e-6 + 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (5.1042e-6 + 4.53e-7x)^2) + (-5.1042e-6 - 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x))) ((4.2e-9 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x)) / ((4.2e-9 + 4.53e-7x)*((4.2e-9 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x)) + (5.1042e-6 + 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (5.1042e-6 + 4.53e-7x)^2) + (-5.1042e-6 - 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x))); ((4.2e-9 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x)) / ((4.2e-9 + 4.53e-7x)*((4.2e-9 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x)) + (5.1042e-6 + 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (5.1042e-6 + 4.53e-7x)^2) + (-5.1042e-6 - 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x))) 0 ((5.1042e-6 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x)) / ((4.2e-9 + 4.53e-7x)*((4.2e-9 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x)) + (5.1042e-6 + 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (5.1042e-6 + 4.53e-7x)^2) + (-5.1042e-6 - 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x)))]
@show B[1,1] =#
#= g111=(-(4.2e-9 + 4.53e-7x)^2) + (5.1042e-6 + 4.53e-7x)^2
B111=simplify(g111, expand=true)
@show B11 #2.60528404e-11 + 4.6206e-12x =#
#= g112=((4.2e-9 + 4.53e-7x)*((4.2e-9 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x)) + (5.1042e-6 + 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (5.1042e-6 + 4.53e-7x)^2) + (-5.1042e-6 - 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x))) 
B112=simplify(g112, expand=true)
@show B11 #1.3286948405e-16 + 2.35650602e-17x - 3.851859888774472e-34(x^2) =#

#= g12=((4.2e-9 + 4.53e-7x)^2 - ((5.1042e-6 + 4.53e-7x)^2))
B112=simplify(g12, expand=true)
@show B112 #-2.60528404e-11 - 4.6206e-12x =#

#= g122=((4.2e-9 + 4.53e-7x)*((4.2e-9 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x)) + (5.1042e-6 + 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (5.1042e-6 + 4.53e-7x)^2) + (-5.1042e-6 - 4.53e-7x)*(-((4.2e-9 + 4.53e-7x)^2) + (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x))) 
B112=simplify(g122, expand=true)
@show B112 #1.3286948405e-16 + 2.35650602e-17x - 3.851859888774472e-34(x^2) =#


#= g21=((4.2e-9 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x))
B21=simplify(g21, expand=true)
@show B21 #-2.14205e-14 - 2.3103004e-12x =#

#= g22=(-((4.2e-9 + 4.53e-7x)^2) + (5.1042e-6 + 4.53e-7x)^2)
B22=simplify(g22, expand=true)
@show B22#2.60528404e-11 + 4.6206e-12x =#

#= g23=((4.2e-9 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x))
B23=simplify(g23, expand=true)
@show B23#-2.14205e-14 - 2.3103004e-12x           ---------> =B31 =#


#= g33=((5.1042e-6 + 4.53e-7x)^2 - (4.2e-9 + 4.53e-7x)*(5.1042e-6 + 4.53e-7x))
B33=simplify(g33, expand=true)
@show B33#2.60314205e-11 + 2.3103e-12x =#


#= B1=[2.605284e-11+4.6206e-12*x  -2.605284e-11-4.6206e-12x  0;-2.142e-14-2.3103e-12x  2.605284e-11+4.6206e-12x -2.142e-14-2.3103e-12x ;-2.142e-14-2.3103e-12x 0 2.60314205e-11+2.3103e-12x]
B=B1/(1.32869484e-16 + 2.356506e-17x - 3.85185988e-34(x^2))
#c=-4.2e-9/0.453e-6
#display(B1);println()
C=[-(rd1+3.88e-3)*il1-(rr+rpr+0.453e-6*v)*I+rd1*is1;-(rd2+3.88e-3)*il2-(rr+rpr+0.453e-6*v)*I+rd2*is2;-(rd3+3.88e-3)*il3-(rr+rpr+0.453e-6*v)*I+rd3*is3]

#display(C)
D=B1*C
#display(D)
D1=simplify(D[1], expand=true)
display(D1);println()
D2=simplify(D[2], expand=true)
display(D2);println()
D3=simplify(D[3], expand=true)
display(D3);println() =#

#= D=[5.1e-6 0 0;0 5.1e-6 0;0 0 5.1e-6]
E=inv(D)
display(E) =#
#= C=substitute.(B, (Dict(x=> c),))
display(C) =#


#= 1/(1.32869484e-16 + 2.356506e-17x - 3.85185988e-34(x^2)){

-1.0108501e-13il1*rd1 + 1.01085e-13il2*rd2 + 2.605284e-11is1*rd1 - 2.605284e-11is2*rd2 - 1.79279e-14il1*rd1*x + 1.7927928e-14il2*rd2*x + 4.6206e-12is1*rd1*x - 4.6206e-12is2*rd2*x

-2.6010e-11I*(rpr + rr) - 1.178253e-17I*v + 8.31096e-17il1*rd1 - 1.010850e-13il2*rd2 + 8.31096e-17il3*rd3 - 2.142e-14is1*rd1 + 2.605284e-11is2*rd2 - 2.142e-14is3*rd3 + 8.963964e-15il1*rd1*x - 1.79279e-14il2*rd2*x + 8.963964e-15il3*rd3*x - 2.3103e-12is1*rd1*x + 4.6206e-12is2*rd2*x - 2.3103e-12is3*rd3*x

-2.6010e-11I*(rpr + rr) - 1.17825e-17I*v + 8.31096e-17il1*rd1 - 1.01001e-13il3*rd3 - 2.142e-14is1*rd1 + 2.60314e-11is3*rd3 + 8.963e-15il1*rd1*x - 8.96396e-15il3*rd3*x - 2.3103e-12is1*rd1*x + 2.3103e-12is3*rd3*x

}

1/(1.32869484e-16 + 2.356506e-17x - 3.85185988e-34(x^2)){

(-1.0108501e-13- 1.79279e-14x)il1*rd1 + (1.01085e-13+1.7927928e-14x)il2*rd2 + (2.605284e-11+4.6206e-12x)is1*rd1 - (2.605284e-11 + 4.6206e-12x)*is2*rd2

-I*(2.6010e-11*(rpr + rr)+1.178253e-17v) + 8.31096e-17il1*rd1 - 1.010850e-13il2*rd2 + 8.31096e-17il3*rd3 - 2.142e-14is1*rd1 + 2.605284e-11is2*rd2 - 2.142e-14is3*rd3 + 8.963964e-15il1*rd1*x - 1.79279e-14il2*rd2*x + 8.963964e-15il3*rd3*x - 2.3103e-12is1*rd1*x + 4.6206e-12is2*rd2*x - 2.3103e-12is3*rd3*x

-I*(2.6010e-11*(rpr + rr)+1.178253e-17v) + 8.31096e-17il1*rd1 - 1.01001e-13il3*rd3 - 2.142e-14is1*rd1 + 2.60314e-11is3*rd3 + 8.963e-15il1*rd1*x - 8.96396e-15il3*rd3*x - 2.3103e-12is1*rd1*x + 2.3103e-12is3*rd3*x

} =#


C=[-(rd1+3.88e-3)*il1-(rr+rpr+0.453e-6*v)*I+rd1*is1;-(rd2+3.88e-3)*il2-(rr+rpr+0.453e-6*v)*I+rd2*is2;-(rd3+3.88e-3)*il3-(rr+rpr+0.453e-6*v)*I+rd3*is3]

#display(C)
D=B*C
display(D)
#= ff= ((0.0042 + 0.453x)*((0.0042 + 0.453x)^2 - (0.0042 + 0.453x)*(5.1042 + 0.453x)) + (-0.0042 - 0.453x)*(-((0.0042 + 0.453x)^2) + (0.0042 + 0.453x)*(5.1042 + 0.453x)) + (5.1042 + 0.453x)*((5.1042 + 0.453x)^2 - ((0.0042 + 0.453x)^2))) 
D1=simplify(ff, expand=true) #132.97872599999997 + 35.34758999999999x

display(D1)


D=[((-I*(rpr + rr + 4.53e-7v) + il3*(-0.00388 - rd3) + is3*rd3)*((0.0042 + 0.453x)^2 - (0.0042 + 0.453x)*(5.1042 + 0.453x))) + ((-I*(rpr + rr + 4.53e-7v) + il2*(-0.00388 - rd2) + is2*rd2)*((0.0042 + 0.453x)^2 - (0.0042 + 0.453x)*(5.1042 + 0.453x))) + ((-I*(rpr + rr + 4.53e-7v) + il1*(-0.00388 - rd1) + is1*rd1)*((5.1042 + 0.453x)^2 - ((0.0042 + 0.453x)^2))), 
   ((-I*(rpr + rr + 4.53e-7v) + il2*(-0.00388 - rd2) + is2*rd2)*((5.1042 + 0.453x)^2 - ((0.0042 + 0.453x)^2)))+((-I*(rpr + rr + 4.53e-7v) + il3*(-0.00388 - rd3) + is3*rd3)*((0.0042 + 0.453x)^2 - (0.0042 + 0.453x)*(5.1042 + 0.453x))) + ((-I*(rpr + rr + 4.53e-7v) + il1*(-0.00388 - rd1) + is1*rd1)*((0.0042 + 0.453x)^2 - (0.0042 + 0.453x)*(5.1042 + 0.453x))),
   ((-I*(rpr + rr + 4.53e-7v) + il2*(-0.00388 - rd2) + is2*rd2)*((0.0042 + 0.453x)^2 - (0.0042 + 0.453x)*(5.1042 + 0.453x))) +((-I*(rpr + rr + 4.53e-7v) + il3*(-0.00388 - rd3) + is3*rd3)*((5.1042 + 0.453x)^2 - ((0.0042 + 0.453x)^2)))+((-I*(rpr + rr + 4.53e-7v) + il1*(-0.00388 - rd1) + is1*rd1)*((0.0042 + 0.453x)^2 - (0.0042 + 0.453x)*(5.1042 + 0.453x)))] =#